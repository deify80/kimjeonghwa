<script>

	$(document).ready(function() {
		
		show_calendar("<?=date('Y')?>", "<?=intval(date('m'))?>");
		
		$("#srch_year").val("<?=date('Y')?>");
		$("#srch_month").val("<?=intval(date('m'))?>");
		
		set_select("<?=intval(date('d'))?>"); 

		$("#srch-frm select").on("change", function() {
			show_calendar($('#srch_year').val(), $('#srch_month').val());
		});
	});

	
	
	function show_calendar(y, m) {

		var date = new Date();
		var now_year = date.getFullYear();
		var now_month = date.getMonth();
		var now_day = date.getDate();

		y = (y != undefined) ? y : now_year;
		m = (m != undefined) ? m - 1 : now_month;

		var the_date = new Date(y, m, 1);
		var the_day = the_date.getDay();

		var last = [ 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 ];

		if (y % 4 == 0 && y % 100 != 0 || y % 400 == 0)
			last_date = last[1] = 29;

		var last_date = last[m];
		var row = Math.ceil((the_day + last_date) / 7);
		var calendar = "<ul class=inline-calendar>";

		var d_num = 1;
		for (var i = 1; i <= row; i++) {
			for (var k = 1; k <= 7; k++) {
				if (i == 1 && k<=the_day || d_num>last_date) {
				} else {
					calendar += "<li onClick=set_select("+d_num+"); id='"+d_num+"'>" + d_num + "</li>";
					d_num++;
				}
			}
		}
		calendar += "</ul>";
		$("#calendar-area").html(calendar);
	}
	
	
	function set_select(d_num) {
		//alert(d_num);
		$(".inline-calendar li").removeClass("selected");
		$("#"+d_num).addClass("selected");
		$("#srch_day").val(d_num);
		
		//해당 내용 출력
		//$( "#calendar-area" ).load( "/finance/report_result/<?=$type?>?"+$("#srch-frm").serialize());

		$.ajax({
 			type : "GET",
 			url : "/finance/report_result/{type}",
 			data : $("#srch-frm").serialize(),
 			success : function(result_data) {

				$("#report-area").hide();
 				/*
 				$("#msg-area").html(result_data);
 				$("#msg-area").dialog("open");
 				*/

 				
 				$("#report-area").html(result_data).fadeIn();

 			}
 		});
		
	}	

var Daily = {
	init : function() {
		$('[data-role="search"]').on('change.search',function() {
			$('#biz_id').val(this.value);
			set_select($("#srch_day").val());
			//show_calendar($('#srch_year').val(), $('#srch_month').val());
		});
	},

	print : function(divName) {
		$('#sign_box').removeClass('hide');
		$('#biz_title').removeClass('hide');

		//alert($("#srch_day").val());
		var y = $("#srch_year").val();
		var m = $("#srch_month").val();
		var d = $("#srch_day").val();
		var biz_id = $('#biz_id').val();

		var printContents = document.getElementById(divName).innerHTML;
		var originalContents = document.body.innerHTML;

		document.body.innerHTML = printContents;
		
		window.print();

		document.body.innerHTML = originalContents;

		Daily.init();

		show_calendar(y, m);
		$("#srch_year").val(y);
		$("#srch_month").val(m);
		$('#biz_id').val(biz_id);

		set_select(d); 

		
	}
}

$(function(){
	Daily.init();
})


	
</script>
<script type="text/javascript" src="/js/bootstrap.button.js"></script>
<script language="javascript" src="/js/template.js"></script>

<form id="srch-frm">
<input type="hidden" name="srch_day" id="srch_day">


<table class="table table-bordered table-form">
	<colgroup>
		<col style="width:100px" />
		<col />
	</colgroup>
	<tbody>
		<tr>
			<td colspan="2">
				
				<div style="clear: both;margin-top: 5px;margin-bottom: 5px;width:100%;height:30px;vertical-align: middle;" id="select-calendar">
					<div style="float: left;margin-top: 5px;">
						<select style="width:80px;" name="srch_year" id="srch_year">
							<? for($i=2015; $i<=2020; $i++): ?>
							<option value="<?=$i?>"><?=$i?>년</option>
							<? endfor; ?>
						</select> 
						<select style="width:80px;" name="srch_month" id="srch_month">
						<? for($i=1; $i<=12; $i++): ?>
							<option value="<?=$i?>"><?=$i?>월</option>
						<? endfor; ?>	
						</select>
					</div>
					<div id="calendar-area" style="float: left; margin-left: 10px;"></div>
				</div>

			</td>
		</tr>

		<tr>
			<th>사업장</th>
			<td>
				<input type = 'hidden' name='biz_id' id='biz_id' value=''>
				<div class="btn-group hmis blue" data-toggle="buttons">
					<label class="btn active"><input type="radio" name="biz_id_sel" value="" data-role="search" />전체</label>
					{@ cfg.biz}
					<label class="btn"><input type="radio" name="biz_id_sel" value="{.key_}" data-role="search" />{.value_}</label>
					{/}	
				</div>
			</td>
		</tr>
	</tbody>
</table>


</form>
<div id="report-area"></div>
