<style>
ul.post li {
	border-bottom:solid 1px #E3E3E3;
	padding:7px;
}

ul.post li div {color:#A2A2A2;}
ul.post li > a:hover, ul.post li > a:hover > div {color:#FE635F;}
</style>

<table class="table table-bordered table-form">
	<colgroup>
		<col style="width:100px" />
		<col>
	</colgroup>
	<tbody>
		<tr>
			<th>
				환자검색
			</th>
			<td>
				<input type="search"  id="search_patient_modal" class="search" style="width:200px" autocomplete="off" placeholder="환자명 or 휴대폰번호" /> 
				<button type="button" class="btn btn-flat-blue btn-onlyicon" onclick="PatientSearch.search()" ><i class="fa fa-search fa-1"></i></button>
				<!-- <button type="button" class="btn btn-gray" onclick="PatientInput.reset()"><i class="fa fa-refresh fa-1"></i> 처음으로</button> -->
			</td>
		</tr>
	</tbody>
</table>
<div class="dashed" style="margin:10px 0px"></div>

<!-- <div id="post_error" class="well error" style="display:;margin-bottom:5px;">
	정확한 도로명과 건물번호 또는 동·리와 번지로 검색해 주시기 바랍니다.
</div> -->

<div id="patient_list" class="well" style="height:400px;overflow-y:auto;padding:5px">
	환자정보를 검색하세요.
</div>

<div class="area-button">
	<button type="button" class="btn btn-gray btn-lg modal-close">닫기</button>
</div>

<textarea id="tmpl_patient" style="display:none">
	<li><a href="javascript:;" onclick="PatientSearch.value('${no}','${name}')"><span style="font-weight:bold;padding-right:10px">${name}</span> ${mobile}</a></li>
</textarea>

<script language="javascript" src="/js/template.js"></script>
<script type="text/javascript">
var PatientSearch = {
	init: function() {
		$('#search_patient_modal').on('keypress',function(e){
			if(e.keyCode === 13) {
				PatientSearch.search();
			}
		});
	},
	search: function() {
		var q = $('#search_patient_modal').val();
		if(q.length <2) {
			HmisAlert.alert("검색어는 2글자 이상 입력해 주세요.", function(){
				$('#search_patient_modal').focus();
			});
			return false;
		}

		$.ajax({
			url: "/patient/patient_list",
			data:{
				search_word:q,
				field:'no, name, mobile, messenger',
			},
			type:'POST',
			dataType:'json',
			success: function(r) {
				var tmpl = TrimPath.parseDOMTemplate('tmpl_patient');
				var target = $('#patient_list');
				target.empty();
				
					var html = '';
					var ul = $('<ul class="post">');
					$.each(r.data, function(i,e){
						html += tmpl.process(e);
					});
					ul.append(html);
					target.append(ul);

				// if(r.count>=100) {
				// 	$('#post_error').html("검색 결과가 너무 많아 100건만 표시합니다.");
				// }
				// else if(r.count < 1){
				// 	$('#post_error').html('<b>검색된 주소가 없습니다.</b> <br />정확한 도로명과 건물번호 또는 동·리와 번지로 검색해 주시기 바랍니다.');	
				// }
				// else {
				// 	$('#post_error').html(r.count+'개의 주소가 검색되었습니다.');		
				// }
				
				
			}
		})
	},
	value: function(user_no, user_name) {
		$('#HmisModal_patient .modal-close').trigger('click', {no:user_no, name:user_name});
	}
}

$(function() {
	PatientSearch.init();
})
</script>
