<button type="button" class="btn btn-theme" onclick="PatientInfo.modalWidget('material', '사용물품 등록')" ><i class="fa fa-plus fa-1"></i> 사용물품등록</button>


<table class="table table-bordered table-center table-form">
	<colgroup>

	</colgroup>
	<thead>
		<tr>
			<th>총 재료비</th>
			<th>사용물품종류</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			
			<td class="f-error">
				{? auth.view_price}
				{=number_format(sum.price_total)}
				{:}
				**,***
				{/}원
			</td>
			<td>{=number_format(sum.kind_count)}</td>
		</tr>
	</tbody>
</table>

<div class="dashed" style="margin:10px 0px"></div>

<table class="table table-bordered table-list table-form table-striped-even">
	<colgroup>
		<col style="width:60px" />
		<col width="60px">
		<col style="width:100px" />
		<col style="width:100px" />
		<col style="width:200px" />
		<col style="width:100px" />
		<col style="width:120px" />
		<col style="width:120px" />
		<col />
	</colgroup>
	<thead>
		<tr>
			<th>선택</th>
			<th><input type="checkbox" class="hmis" onclick="HmisCommon.toggleCheck(this, 'checked_material[]')"><span class="lbl"></span></th>
			<th>분류</th>
			<th>항목</th>
			<th>품목명</th>
			<th>수량</th>
			<th>개당단가</th>
			<th>재료비</th>
			<th>특이사항</th>
		</tr>
	</thead>
	<tbody>
		{@ list}
		<tr>
			<td>{.idx}</td>
			<td><input type="checkbox" class="hmis" name="checked_material[]" value="{.no}"><span class="lbl"></span></td>
			<td>{.goods_info[0].classify_name}</td>
			<td>{.goods_info[0].item_name}</td>
			<td><a href="javascript:;" onclick="WidgetMaterial.modify('{.no}')" class="link" >{.goods_name}</a></td>
			<td>{.use_count}개</td>
			<td>			
				{? auth.view_price}
				{=number_format(.goods_price)}
				{:}
				**,***
				{/}
			</td>
			<td>
				{=number_format(.goods_price*.use_count)}원
			</td>
			<td class="left"><div class="ellipsis">{.comment}</div></td>
		</tr>
		{:}
		<tr>
			<td colspan="9" class="center">등록된 물품기록이 없습니다.</td>
		</tr>
		{/}
	</tbody>
</table>

<div style="margin-top:7px;position:relative;height:20px">
	{? auth.delete}
	<button type="button" onclick="WidgetMaterial.remove()" class="btn btn-flat-orange">삭제</button>
	{/}
	<div style="position:absolute;right:0px;bottom:0px">
		<div id="pagination">
			<ul class="pagination small">
				<li><a href="javascript:;" onclick="PatientInfo.loadTab('{tab}','{paging.first}')"><i class="fa fa-angle-double-left"></i></a></li>
				<li><a href="javascript:;" onclick="PatientInfo.loadTab('{tab}','{paging.prev}')"><i class="fa fa-angle-left"></i></a></li>
				{@ paging.block}
				<li class="{? .equal}active{/}"><a href="javascript:;" onclick="PatientInfo.loadTab('{tab}','{.num}')">{.num}</a></li>
				{/}
				<li><a href="javascript:;" onclick="PatientInfo.loadTab('{tab}','{paging.next}')"><i class="fa fa-angle-right"></i></a></li>
				<li><a href="javascript:;" onclick="PatientInfo.loadTab('{tab}','{paging.last}')"><i class="fa fa-angle-double-right"></i></a></li>
			</ul>
		</div>
	</div>
</div>

<script type="text/javascript">
var WidgetMaterial = {
	modify: function(no) {
		PatientInfo.modalWidget('material', '물품기록 수정', {no:no});
	},
	remove: function(){
		var checked = HmisCommon.getChecked('checked_material[]');
		if (checked.length<1) {
			HmisAlert.alert('삭제할 물품을 선택하세요.');
			return false;
		}
		
		var me = this;
		HmisAlert.confirm('삭제하시겠습니까?', function(r) {
			if(r) {
				var material_no = checked.map(function () {return this.value;}).get();
				
				$.ajax({
					url:'/patient_proc/remove_patient_material',
					data:{
						patient_no:PatientInfo.patient_no,
						project_no:PatientInfo.project_no,
						material_no:material_no
					},
					dataType:'json',
					type:'POST',
					success: function(r){
						if(r.success){
							PatientInfo.loadTab('{tab}');
							PatientInfo.countTab();
						}
						else {
							alert(r.msg);
						}
					}
				})	
			}
			
		});
	}
};
</script>