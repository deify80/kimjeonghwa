<form id="FrmPatientNurseInput" onsubmit="return false">
<input type="hidden" name="patient_no" value="{rs.patient_no}" />
<input type="hidden" name="project_no" value="{rs.project_no}" />
<input type="hidden" name="mode" value="{mode}" />
<input type="hidden" name="nurse_no" value="{rs.no}" />
<table class="table table-bordered table-form">
	<colgroup>
		<col style="width:120px" />
		<col />
		<col style="width:120px" />
		<col />
	</colgroup>
	<tbody>
		<tr>
			<th>수술간호일자</th>
			<td>
				<input type="text" name="date_nurse" value="{rs.date_nurse}" class="datepicker lg"/>
			</td>
			<th>담당의사</th>
			<td>
				<select name="doctor_id">
					<option value="">::담당의사::</option>
					{@ cfg.doctor}
					<option value="{.key_}" {? rs.doctor_id ==.key_ }selected{/}>{.value_}</option>
					{/}
				</select>
			</td>
		</tr>
		<tr>
			<th>보조의사</th>
			<td colspan="3">
				<select name="assistance_id">
					<option value="">::보조의사::</option>
					{@ cfg.doctor}
					<option value="{.key_}" {? rs.assistance_id ==.key_ }selected{/}>{.value_}</option>
					{/}
				</select>
			</td>
		</tr>
		<tr>
			<th>간호사</th>
			<td colspan="3">
				{@ cfg.nurse}
				<label class="hmis"><input type="checkbox" name="nurse_id[]" value="{.key_}" class="hmis" {? is_array(rs.nurse_id_arr) && in_array(.key_, rs.nurse_id_arr)}checked{/} /><span class="lbl"> {.name}</span></label>
				{/}

			</td>
		</tr>
		<tr>
			<th>치료구분</th>
			<td  colspan="3">
				{@ cfg.treat_type}
				<label class="hmis"><input type="radio" name="treat_type_code" value="{.key_}" class="hmis" {? rs.treat_type_code==.key_}checked{/} /><span class="lbl"> {.value_}</span></label>
				{/}
			</td>
		</tr>
		<tr>
			<th>마취구분</th>
			<td  colspan="3">
				<label class="hmis"><input type="radio" name="anesthesia_type" value="1" class="hmis" {? rs.anesthesia_type=='전신마취'}checked{/} /><span class="lbl"> 전신마취</span></label>
				<label class="hmis"><input type="radio" name="anesthesia_type" value="2" class="hmis" {? rs.anesthesia_type=='수면마취'}checked{/} /><span class="lbl"> 수면마취</span></label>
				<label class="hmis"><input type="radio" name="anesthesia_type" value="3" class="hmis" {? rs.anesthesia_type=='국소마취'}checked{/} /><span class="lbl"> 국소마취</span></label>
			</td>
		</tr>
		<tr>
			<th>입실시각</th>
			<td>
				<input type="text" name="time_in" value="{rs.time_in}" class="center" data-mask="time" style="width:80px" />
			</td>
			<th>퇴실시각</th>
			<td>
				<input type="text" name="time_out" value="{rs.time_out}" class="center"  data-mask="time" style="width:80px" />
			</td>
		</tr>
		<tr>
			<th>키/몸무게</th>
			<td>
				<input type="text" name="height" value="{rs.height}" style="width:50px" class="center validate[custom[onlyNumber]]" /> cm / <input type="text" name="weight" value="{rs.weight}" style="width:50px" class="center validate[custom[onlyNumber]]" /> kg
			</td>
			<th>BP</th>
			<td>
				<input type="text" name="bp" value="{rs.bp}"  class="center" style="width:80px"/> mmHg
			</td>
		</tr>
		<tr>
			<th rowspan="2">수술부위</th>
			<td colspan="3" style="">
				<button type="button" onclick="HmisCommon.treat('HmisTreat.addTreat','{parient.treat_cost_no}')" class="btn btn-flat-lightgray btn-onlyicon"><i class="fa fa-search fa-1"></i></button>
			</td>
		</tr>
		<tr>
			<td colspan="3" style="padding-bottom:0px">

				<div id="treat_null" style="padding:6px 0px 13px;">수술부위를 선택하세요.</div>
				<div id="treat_list">
					{@ rs.treat_info}
					<span class="label label-default" style="" id="{.key_}">{.value_} <i class="fa fa-times fa-1" style="margin-left:10px;cursor:pointer;vertical-align: -1px" onclick="HmisTreat.removeTreat('{.key_}')"></i></span>
					{/}
				</div>
			</td>
		</tr>
		<tr>
			<th rowspan="3">투약</th>
			<td colspan="3">
				<table style="width:100%">
					<colgroup>
						<col style="width:80px" />
						<col />
						<col style="width:80px" />
						<col />
						<col style="width:80px" />
						<col />
					</colgroup>
					<tr>
						<td><b>Pofol</b></td>
						<td class="left"><input type="text" name="medication[profol]" value="{rs.medication.profol}" style="width:50px" /> ⓥ</td>
						<td><b>Ketamine</b></td>
						<td class="left"><input type="text" name="medication[ketamine]" value="{rs.medication.ketamine}" style="width:50px" /> ml</td>
						<td><b>Midazolam</b></td>
						<td class="left"><input type="text" name="medication[midazolam]" value="{rs.medication.midazolam}" style="width:50px" /> cc</td>
					</tr>

				</table>
			</td>
		</tr>
		<tr>
			<td colspan="3">
				<table style="width:100%">
					<colgroup>
						<col style="width:80px" />
						<col style="width:330px" />
						<col style="width:130px" />
						<col />
					</colgroup>
					<tr>
						<td><b>Cefa AST</b></td>
						<td class="left">
							<label class="hmis"><input type="radio" name="medication[cefa_type]" value="N" class="hmis" {? rs.medication.cefa_type=='N'}checked{/} /> <span class="lbl"> N</span></label>
							<label class="hmis"><input type="radio" name="medication[cefa_type]" value="P" class="hmis" {? rs.medication.cefa_type=='P'}checked{/}> <span class="lbl"> P</span></label>
							<input type="text" name="medication[cefa]" value="{rs.medication.cefa}" style="width:50px" /> ⓥ Iv
						</td>
						<td><b>시프로플록사신 100ml</b></td>
						<td class="left"><input type="text" name="medication[ciprofloxacin]" value="{rs.medication.ciprofloxacin}" style="width:50px" /> Iv</td>
					</tr>

				</table>
			</td>
		</tr>
		<tr>
			<td colspan="3">
				<table style="width:100%">
					<colgroup>
						<col style="width:80px" />
						<col />
						<col style="width:80px" />
						<col />
						<col style="width:80px" />
						<col />
					</colgroup>
					<tr>
						<td><b>Mobinul</b></td>
						<td class="left"><input type="text" name="medication[mobinum]" value="{rs.medication.mobinum}" style="width:50px" /> cc</td>
						<td><b>Kerola</b></td>
						<td class="left"><input type="text" name="medication[keroal]" value="{rs.medication.keroal}" style="width:50px" /> @</td>
						<td><b>GM</b></td>
						<td class="left"><input type="text" name="medication[gm]" value="{rs.medication.gm}" style="width:50px" /> @</td>
					</tr>
				</table>
			</td>
		</tr>

		<tr>
			<th>비고</th>
			<td colspan="3">
				<textarea name="comment" style="height:100px;overflow-y:auto" class="hmis">{rs.comment}</textarea>
			</td>
		</tr>
	</tbody>
</table>

<div class="area-button">
	<button type="submit" class="btn btn-theme btn-lg">저장</button>
	<button type="button" class="btn btn-gray btn-lg modal-close">닫기</button>
</div>
</form>

<script language="javascript" src="/js/jquery.maskedinput.min.js"></script>
<script type="text/javascript">
var PatientNurseInput = {
	init: function() {
		var me = this;
		var option = $.extend({},validation_option, {
			onValidationComplete: function(form, status){
				HmisAlert.confirm('저장하시겠습니까?', function(r){
					if(r) if(status) me.save();
				})

			}
		});

		$('input[data-mask="time"]').mask('99:99');

		$("#FrmPatientNurseInput").validationEngine('attach',option);
		this.buildTreat();
		HmisCommon.createDatepicker();
	},
	buildTreat: function() {
		if($('#treat_list > span').length>0) {
			$('#treat_null').css('display','none');
		}
		else {
			$('#treat_null').css('display','');
		}
	},
	save: function(){
		var treat = $('#treat_list > span').map(function(){ return $(this).attr('id'); }).get();
		var formdata = $('#FrmPatientNurseInput').serializeArray();
		formdata.push({name:'treat', value:treat});

		$.ajax({
			url:'/patient_proc/save_patient_nurse',
			data:formdata,
			dataType:'json',
			type:'POST',
			success: function(r) {
				if(r.success) {
					$('.modal-close').trigger('click');
					PatientInfo.loadTab('nurse');
					PatientInfo.countTab();
				}
				else {
					HmisAlert.alert(r.msg);
				}
			}
		})
	}
}

$(function(){
	PatientNurseInput.init();
})
</script>
