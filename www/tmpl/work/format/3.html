<!-- 일일매출보고 포맷 -->

<script type="text/javascript" src="/js/template.js"></script>
<script type="text/javascript">

var BizFormat = {
	init:function() {
		$('#mode').val('');
		$('#expense_customer').focus();		

		var checked = $(':radio[name="team_code_search"]:checked').val();

		$('#team_code').val(checked);
		$('#biz_type').val(WorkBiz.selectSalesBizType(checked));

		HmisCommon.createDatepicker();
		this.createNumber();

		//this.load();

		$("#FrmBizInput :input").keypress(function(){
            if (event.keyCode == 13) {
				BizFormat.add();
            }
        });

		if($('#work_type').val() != ''){
			$('.col_span').attr("colSpan",2);
			$('.td_hide').addClass('hide');
		}
	},
	createNumber : function() {
		var me = this;
		$("input.number").attr('placeholder','0');
		$("input.number").attr('autocomplete','off');
		$("input.number").unbind('keyup.number').bind('keyup.number', function(){
			var e = $(this);
			e.val( HmisCommon.numberFormat(e.val()) );
			me.calculatePrice(e.data('group'), e.data('name'));	
		
		})
	},
	add : function() {

		var formdata = $('#FrmBizInput').serialize();
		var biz_type = $('#biz_type').val();

		$.ajax({
			url : "/work_proc/add_biz_sales_skin_log",
			data : formdata,
			dataType:'json',
			type : "POST",
			success : function(r) {
				if(r.success){
					//BizFormat.reset();
					//BizFormat.load();
					WorkBiz.load(biz_type);
				}
				else {
					HmisAlert.alert('잠시 후에 다시 시도해주세요.');
				}

			}
		});
	},
	remove :function(no) {
		HmisAlert.confirm('삭제하시겠습니까?', function(r) {
			if(r) {
				var formdata = $('#FrmBizInput').serialize();
				var biz_type = $('#biz_type').val();

				$.ajax({
					url : "/work_proc/remove_biz_sales_log",
					data:{
						no:no,
						biz_type:biz_type
					},
					dataType:'json',
					type : "POST",
					success : function(r) {
						if(r.success){
							//BizFormat.load();
							WorkBiz.load(biz_type);
						}
						else {
							HmisAlert.alert('잠시 후에 다시 시도해주세요.');
						}

					}
				});
			}
			
		});

	},
	reset: function() {
		$("#FrmBizInput")[0].reset();
   	},
	calculatePrice : function(group, name) {
		var sum = 0;
		// 총액
		$.each($('input[data-group="'+group+'"]'), function(i,e){
			var price = $(e).val().replace(/,/gi,'');
			if ($.isNumeric(price)) {
				sum+=parseInt(price);
			}
		});
		$('#expense_'+group+'_price').val(HmisCommon.numberFormat(sum));
		//this.calculateTotal(group, name);
	},
	calculateTotal : function(group, name) {
		var total_price = 0;

		$("input:enabled[id^=expense_"+group+"_price]" ).each(function() {
			if( this.value ){
				total_price = parseInt(total_price) + parseInt(this.value.replace(/[^0-9]/g,''));
			}
		});

		$("#total_"+group+"_price").val(total_price.number_format(0));				// 총액

		// 현금, 카드, 계좌, 환불, 미수금
		total_price = 0;
		$.each($('input[name^=expense_'+group+'_'+name+']'), function(i,e){
			if( this.value ){
				total_price = parseInt(total_price) + parseInt(this.value.replace(/[^0-9]/g,''));
			}
		});
		$("#total_"+group+"_"+name).val(total_price.number_format(0));
	},
	
};

$(function(){
	BizFormat.init();	
});

</script>
<!-- 피부관리팀 -->

<div id="biz_title"  class="hide">
	<p style="text-align:center; font-size:20px; font-weight:bold">매출현황( {=search_date} )</p>
	<table id="sign_box" class="table table-center" style="margin-top:5px;margin-bottom:0px">
		<tr>
			<td colspan="6">
			</td>
			<td style="width:300px">
				<table id="sign_box" class="table table-bordered table-center" style="margin-top:5px;margin-bottom:0px" border="1">
					<tr>
						<th>&nbsp;&nbsp;&nbsp;&nbsp;담 당 자&nbsp;&nbsp;&nbsp;&nbsp;</th>
						<th>&nbsp;&nbsp;&nbsp;&nbsp;이    사&nbsp;&nbsp;&nbsp;&nbsp;</th>
						<th>&nbsp;&nbsp;&nbsp;&nbsp;대표이사&nbsp;&nbsp;&nbsp;&nbsp;</th>
					</tr>
					<tr>
						<td style="height: 60px;"></td>
						<td style="height: 60px;"></td>
						<td style="height: 60px;"></td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
</div>


<form id="FrmBizInput" onsubmit="return false">
<input type="hidden" name="team_code" id="team_code" value="">
<input type="hidden" name="biz_type" id="biz_type" value="">
<input type="hidden" name="is_schedule" id="is_schedule" value="N">

<table class="table table-bordered table-center" style="margin-top:5px;margin-bottom:0px" border="1">
	<colgroup>
		<col width="30px" /><!-- No -->
		<col width="100px" /><!-- 일자 -->
		<col width="80px" /><!-- 이름 -->
		<col width="100px" /><!-- 연락처(뒷번호) -->
		<col/><!-- OP내용 -->
		<col width="100px" /><!-- 총금액 -->
		<col width="80px" /><!-- 원장(목록:인트라넷 원장 기준) -->
		<col class="col_span"/>				<!-- 비고 -->
		<col width="30px"  class="td_hide"/><!-- 추가/삭제 버튼 -->
	</colgroup>
	<thead>
		<tr style="background-color:#b6b6b6">
			<th>No</th>
			<th>OP날짜</th>
			<th>이름</th>
			<th>연락처(뒷번호)</th>
			<th>OP내용</th>
			<th>총금액</th>
			<th>담당의</th>
			<th class="col_span">비고</th>
			<th class="td_hide"></th>
		</tr>
	</thead>
	<tbody >
		{? mode != 'excel'  && cfg.work_type == ''}
		<tr class="td_hide">
			<td></td>
			<td><input type='text' class='datepicker' name='expense_op_date' id='expense_op_date' value="<?=date('Y-m-d')?>" /></td>		<!-- 일자 -->
			<td><input type='text' class="full" name='expense_customer' id='expense_customer' value='' /></td>	<!-- 이름 -->
			<td><input type='text' class="full" name='expense_tel' value='' /></td><!-- 연락처(뒷번호) : 숫자 -->
			<td><input type='text' class="full" name='expense_op_contents' value='' /></td><!-- OP내용 -->
			<td><input type='text' class='number full' name='expense_receipt_price' id='expense_receipt_price' value='' data-group="receipt"></td><!-- 총금액 -->
			<td>
				<select name='expense_doctor' id='expense_doctor'>
					{@ cfg.work_biz_expense_doctor }
					<option value='{.key_}'>{.value_}</option>
					{/}
				</select>
			</td>		<!-- 원장 -->

			<td><input type='text' class='full' name='expense_etc' id='expense_etc' value=''></td>	<!-- 비고 -->
			<td><span class='badge lg green' onClick='BizFormat.add();' style='cursor:pointer;vertical-align: middle;'><i class="fa fa-plus"></i></span></td>		<!-- 추가버튼 -->
		</tr>
		{/}

		{@ list}
		<tr>
			<td>{.idx}</td>
			<td>{.expense_op_date}</td>
			<td>{.expense_customer}</td>
			<td>{.expense_tel}</td>
			<td>{.expense_op_contents}</td>
			<td>{=number_format(.expense_receipt_price)}</td>
			<td>{.doctor_name}</td>
			<td class="col_span" style="text-align:left">{.expense_etc}</td>
			<td class="td_hide"><span class='badge lg red' onClick="BizFormat.remove('{.no}')" style='cursor:pointer;vertical-align: middle;'><i class="fa fa-minus"></i></span></td>
		</tr>
	
		{/}	
		<tr>
			<th colspan="5" style="text-align:center;">합계</th>
			<th>{=number_format(total.expense_receipt_price)}</th>
			<th colspan="3"></th>
		</tr>
		
	</tbody>

</table>

<!-- <div id="sales_list" style="padding: 0;margin: 0;"></div> -->
</form>
