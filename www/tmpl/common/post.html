<style>
ul.post li {
	border-bottom:solid 1px #E3E3E3;
	padding:7px;
}

ul.post li div {color:#A2A2A2;}
ul.post li > a:hover, ul.post li > a:hover > div {color:#FE635F;}


</style>

<table class="table table-bordered table-form">
	<colgroup>
		<col style="width:100px" />
		<col>
	</colgroup>
	<tbody>
		<tr>
			<th>
				주소검색
			</th>
			<td>
				<input type="search"  id="search_post" class="search" style="width:300px" autocomplete="off" placeholder="주소검색" />
				<button type="button" class="btn btn-flat-blue btn-onlyicon" onclick="Post.search()" ><i class="fa fa-search fa-1"></i></button>
				<!-- <button type="button" class="btn btn-gray" onclick="PatientInput.reset()"><i class="fa fa-refresh fa-1"></i> 처음으로</button> -->
			</td>
		</tr>
	</tbody>
</table>
<div class="dashed" style="margin:10px 0px"></div>

<div id="post_error" class="well error" style="display:;margin-bottom:5px;">
	정확한 도로명과 건물번호 또는 동·리와 번지로 검색해 주시기 바랍니다.
</div>

<div id="post_list" class="well" style="height:400px;overflow-y:auto;padding:5px">
	주소를 검색하세요.
</div>


<div class="area-button">
	<button type="button" class="btn btn-gray btn-lg modal-close">닫기</button>
</div>

<textarea id="tmpl_post" style="display:none">
	<li><a href="javascript:;" onclick="Post.value('${code6}','${address.base} ${address.building} ${address.new} (${address.old})')"><span style="font-weight:bold;padding-right:10px">${code6}</span> ${address.base} ${address.building} ${address.new} (${address.old}) {if other.others} <div style="margin-top:3px;margin-left:66px">${other.others}</div> {/if}</a></li>
</textarea>

<script language="javascript" src="/js/template.js"></script>
<script src="//cdn.poesis.kr/post/search.min.js"></script>
<script type="text/javascript">
var Post = {
	ref:"<?=$ref?>",
	target:JSON.parse('<?=json_encode($target)?>'),
	init: function() {
		$('#search_post').on('keypress',function(e){
			if(e.keyCode === 13) {
				Post.search();
			}
		});
	},
	search: function() {
		var q = $('#search_post').val();
		if(q.length <3) {
			HmisAlert.alert("검색어는 3글자 이상 입력해 주세요.", function(){
				$('#search_post').focus();
			});
			return false;
		}

		$.ajax({
			url:'https://api.poesis.kr/post/search.php',
			data:{
				v:'2.5',
				q:q,
				ref:this.ref
			},
			dataType:'json',
			success: function(r) {
				var tmpl = TrimPath.parseDOMTemplate('tmpl_post');
				var target = $('#post_list');
				target.empty();

					var html = '';
					var ul = $('<ul class="post">');
					$.each(r.results, function(i,e){
						e.idx = i;
						html += tmpl.process(e);

					});
					ul.append(html);
					target.append(ul);

				if(r.count>=100) {
					$('#post_error').html("검색 결과가 너무 많아 100건만 표시합니다. <br />정확한 도로명과 건물번호 또는 동·리와 번지로 검색해 주시기 바랍니다.");
				}
				else if(r.count < 1){
					$('#post_error').html('<b>검색된 주소가 없습니다.</b> <br />정확한 도로명과 건물번호 또는 동·리와 번지로 검색해 주시기 바랍니다.');
				}
				else {
					$('#post_error').html(r.count+'개의 주소가 검색되었습니다.');
				}
			}
		})
	},
	value: function(zipcode, address) {
		$('#'+this.target.zipcode).val(zipcode);
		$('#'+this.target.address).val(address);
		$('#HmisModal_modal-post .modal-close').trigger('click');
	}
}

$(function() {
	Post.init();
})
</script>
